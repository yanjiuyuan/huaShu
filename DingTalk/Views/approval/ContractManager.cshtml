@{
    Layout = null;
}

<!--右侧实体内容-->
<div id="partPage">
    <!--标题-->
    <div class="head-fixed" onclick="loadPage('/Main/approval')">
        <i class="el-icon-arrow-left"></i>
        合同管理
    </div>
    <!--创建项目表单-->
    <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="120px" class="demo-ruleForm"
             enctype="multipart/form-data">
        <template>
            <el-form-item label="合同编号" prop="ContractNo">
                <el-input v-model="ruleForm.ContractNo"></el-input>
            </el-form-item>

            <el-form-item label="合同签订单位" prop="SignUnit">
                <el-input v-model="ruleForm.SignUnit"></el-input>
            </el-form-item>

            <el-form-item label="销售经理">
                <el-input v-model="ruleForm.SalesManager"></el-input>
            </el-form-item>

            <el-form-item label="合同类型">
                <el-input v-model="ruleForm.ContractType"></el-input>
            </el-form-item>

            <el-form-item>
                <el-button type="primary" v-on:click="addProject" :disabled="disablePage">添加</el-button>
                <el-button type="primary" v-on:click="getData">获取合同列表</el-button>
            </el-form-item>
        </template>
    </el-form>

    <div>
        <!--新闻列表表格實體-->
        <el-table :data="data" stripe border>
            <el-table-column prop="ContractNo" label="合同编号"></el-table-column>
            <el-table-column prop="SignUnit" label="合同签订单位"></el-table-column>
            <el-table-column prop="SalesManager" label="销售经理"></el-table-column>
            <el-table-column prop="ContractType" label="合同类型"></el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-button size="mini" type="danger"
                               v-on:click="delete(scope.$index, scope.row)">删除</el-button>
                </template>
            </el-table-column>
        </el-table>
        <!--底部翻頁-->
        <div style="text-align:right">
            <el-pagination v-on:size-change="handleSizeChange"
                           v-on:current-change="handleCurrentChange"
                           :current-page="currentPage"
                           :page-sizes="[1, 3, 5, 10]"
                           :page-size="pageSize"
                           layout="total, sizes, prev, pager, next, jumper"
                           :total="totalRows">
            </el-pagination>
        </div>
    </div>
</div>


<script>
    var Index = 0
    var date = new Date()
    var demo = new Vue({
        el: "#partPage",
        mixins: [mixin],
        data: function () {
            return {
                ruleForm: {
                    ContractNo: '',
                    SignUnit: '',
                    SalesManager: '',
                    ContractType: '',
                },
                data: []
            }
        },
        methods: {
            //添加
            addProject() {
                var that = this
                this.$refs['ruleForm'].validate((valid) => {
                    if (valid) {
                        that._postData('/ContractManager/Add', function (data) {
                            that.$alert('恭喜提交成功', '提示信息', {
                                confirmButtonText: '确定',
                                callback: action => {
                                    //goHome()
                                }
                            })
                        }, that.ruleForm)
                    }
                })

            },
            //获取数据
            getData() {
                var that = this
                var param = {
                    type: this.ruleForm.Type,
                    pageIndex: this.currentPage,
                    pageSize: this.pageSize
                }
                this._getData("/ContractManager/Quary", function (result) {
                    that.data = result.data
                    that.totalRows = result.count
                }, param)
            },
            //删除
            delete(index,news) {
                var that = this
                that._getData('/ContractManager/Del', function (result) {
                    if (result.error.errorCode != 0) {
                        that.elementAlert('报错了', result.error.errorMessage)
                        return
                    }
                    that.getData()
                }, {
                        id: news.Id
                    })
            }
        },
        created: function () {
            loadHtml("mainPage", "partPage")
        }
    })


</script>